___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "GetCookies CMP",
  "description": "Cookie consent banner with full Google Consent Mode v2 support. GDPR, CCPA, and ePrivacy compliant.",
  "categories": [
    "TAG_MANAGEMENT",
    "PERSONALIZATION"
  ],
  "brand": {
    "id": "getcookies",
    "displayName": "GetCookies",
    "thumbnail": "data:image/png;base64,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"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "domainId",
    "displayName": "Domain ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
        ]
      },
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Find your Domain ID in the GetCookies dashboard at https://getcookies.co under Domains â†’ Widget Configuration",
    "valueHint": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "notSetText": "Please enter your Domain ID from the GetCookies dashboard"
  },
  {
    "type": "CHECKBOX",
    "name": "consentModeEnabled",
    "checkboxText": "Enable Google Consent Mode v2",
    "simpleValueType": true,
    "defaultValue": true,
    "help": "Enable Consent Mode if one or more of your tags rely on Google\u0027s consent API. GetCookies will automatically signal the user\u0027s consent choices to Google tags (Analytics, Ads, etc.).",
    "alwaysInSummary": true
  },
  {
    "type": "GROUP",
    "name": "consentModeSettings",
    "displayName": "Consent Mode Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "waitForUpdate",
        "displayName": "Wait for update (milliseconds)",
        "simpleValueType": true,
        "defaultValue": 500,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "NON_NEGATIVE_NUMBER"
          }
        ],
        "help": "How long Google tags will wait for consent before firing in cookieless mode. Recommended: 500ms.",
        "valueUnit": "milliseconds"
      },
      {
        "type": "SELECT",
        "name": "adsDataRedaction",
        "displayName": "Redact ads data when consent denied",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "dynamic",
            "displayValue": "Dynamic (match ad_storage)"
          },
          {
            "value": true,
            "displayValue": "Always redact"
          },
          {
            "value": false,
            "displayValue": "Never redact"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "dynamic",
        "help": "When enabled and ad_storage consent is denied, ad click identifiers sent in network requests by Google Ads and Floodlight tags will be redacted."
      },
      {
        "type": "CHECKBOX",
        "name": "urlPassthrough",
        "checkboxText": "Enable URL passthrough",
        "simpleValueType": true,
        "defaultValue": true,
        "help": "When enabled, ad click information (gclid, dclid, etc.) will be passed through URL parameters across pages when cookies are denied, helping preserve conversion measurement."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "consentModeEnabled",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "defaultConsentSettings",
    "displayName": "Default Consent State",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "defaultAnalytics",
        "displayName": "Analytics (analytics_storage)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Default state for analytics cookies (Google Analytics, etc.)"
      },
      {
        "type": "SELECT",
        "name": "defaultAdStorage",
        "displayName": "Advertising (ad_storage)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Default state for advertising cookies (Google Ads, Meta Pixel, etc.)"
      },
      {
        "type": "SELECT",
        "name": "defaultAdUserData",
        "displayName": "Ad User Data (ad_user_data)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Default state for sending user data to Google for advertising purposes"
      },
      {
        "type": "SELECT",
        "name": "defaultAdPersonalization",
        "displayName": "Ad Personalization (ad_personalization)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Default state for personalized advertising (remarketing)"
      },
      {
        "type": "SELECT",
        "name": "defaultFunctionality",
        "displayName": "Functionality (functionality_storage)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Default state for functionality cookies (preferences, language settings)"
      },
      {
        "type": "SELECT",
        "name": "defaultPersonalization",
        "displayName": "Personalization (personalization_storage)",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "denied",
        "help": "Default state for personalization cookies (recommendations, content customization)"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "consentModeEnabled",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "help": "Configure the default consent state before user interaction. For GDPR compliance, all should be set to \u0027Denied\u0027."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');
const gtagSet = require('gtagSet');
const JSON = require('JSON');
const localStorage = require('localStorage');
const setInWindow = require('setInWindow');
const logToConsole = require('logToConsole');
const queryPermission = require('queryPermission');

// Configuration from template parameters
const domainId = data.domainId;
const consentModeEnabled = data.consentModeEnabled !== false;
const waitForUpdate = data.waitForUpdate || 500;
const urlPassthrough = data.urlPassthrough !== false;
const adsDataRedaction = data.adsDataRedaction || 'dynamic';

// Default consent values from settings
const defaultAnalytics = data.defaultAnalytics || 'denied';
const defaultAdStorage = data.defaultAdStorage || 'denied';
const defaultAdUserData = data.defaultAdUserData || 'denied';
const defaultAdPersonalization = data.defaultAdPersonalization || 'denied';
const defaultFunctionality = data.defaultFunctionality || 'denied';
const defaultPersonalization = data.defaultPersonalization || 'denied';

// Storage key for consent (must match GetCookies widget)
const CONSENT_KEY = 'getcookies_consent';

// Set up Google Consent Mode v2
if (consentModeEnabled) {
  // Set URL passthrough and developer ID
  gtagSet({
    'url_passthrough': urlPassthrough,
    'developer_id.dODAxZj': true
  });

  // Set default consent state (before any tags fire)
  const defaultConsent = {
    ad_storage: defaultAdStorage,
    ad_user_data: defaultAdUserData,
    ad_personalization: defaultAdPersonalization,
    analytics_storage: defaultAnalytics,
    functionality_storage: defaultFunctionality,
    personalization_storage: defaultPersonalization,
    security_storage: 'granted',
    wait_for_update: waitForUpdate
  };

  setDefaultConsentState(defaultConsent);
  logToConsole('GetCookies: Default consent state set', defaultConsent);

  // Check for existing consent in localStorage
  if (queryPermission('access_local_storage', 'read', CONSENT_KEY)) {
    const storedConsent = localStorage.getItem(CONSENT_KEY);

    if (storedConsent) {
      const parsed = JSON.parse(storedConsent);

      if (parsed && parsed.categories) {
        const categories = parsed.categories;
        const hasAnalytics = categories.indexOf('analytics') > -1;
        const hasMarketing = categories.indexOf('marketing') > -1 || categories.indexOf('advertising') > -1;
        const hasPreferences = categories.indexOf('preferences') > -1 || categories.indexOf('functional') > -1;

        const consentUpdate = {
          ad_storage: hasMarketing ? 'granted' : 'denied',
          ad_user_data: hasMarketing ? 'granted' : 'denied',
          ad_personalization: hasMarketing ? 'granted' : 'denied',
          analytics_storage: hasAnalytics ? 'granted' : 'denied',
          functionality_storage: hasPreferences ? 'granted' : 'denied',
          personalization_storage: hasPreferences ? 'granted' : 'denied',
          security_storage: 'granted'
        };

        updateConsentState(consentUpdate);
        logToConsole('GetCookies: Restored consent from storage', consentUpdate);

        // Set ads data redaction based on marketing consent
        const redactionValue = adsDataRedaction === 'dynamic' ? !hasMarketing : adsDataRedaction === true;
        gtagSet({ 'ads_data_redaction': redactionValue });
      }
    } else {
      // No stored consent - set initial ads data redaction (denied state)
      const redactionValue = adsDataRedaction === 'dynamic' ? true : adsDataRedaction === true;
      gtagSet({ 'ads_data_redaction': redactionValue });
    }
  }
}

// Set up listener for consent updates from GetCookies widget
setInWindow('__GetCookiesGTM', {
  updateConsent: function(choices) {
    if (!consentModeEnabled) return;

    const consentUpdate = {
      ad_storage: choices.marketing ? 'granted' : 'denied',
      ad_user_data: choices.marketing ? 'granted' : 'denied',
      ad_personalization: choices.marketing ? 'granted' : 'denied',
      analytics_storage: choices.analytics ? 'granted' : 'denied',
      functionality_storage: choices.preferences ? 'granted' : 'denied',
      personalization_storage: choices.preferences ? 'granted' : 'denied',
      security_storage: 'granted'
    };

    updateConsentState(consentUpdate);

    // Update ads data redaction
    const marketingGranted = choices.marketing === true;
    const redactionValue = adsDataRedaction === 'dynamic' ? !marketingGranted : adsDataRedaction === true;
    gtagSet({ 'ads_data_redaction': redactionValue });

    logToConsole('GetCookies: Consent updated by user', consentUpdate);
  }
}, true);

// Set domain ID as global variable so widget.js can read it
setInWindow('__GETCOOKIES_DOMAIN_ID', domainId, true);

// Build the loader script URL with domain ID
const scriptUrl = 'https://api.getcookies.co/api/v1/widget/loader.js?id=' + domainId;

// Inject the GetCookies widget script
injectScript(scriptUrl, function() {
  logToConsole('GetCookies: Widget loaded successfully for domain ' + domainId);
  data.gtmOnSuccess();
}, function() {
  logToConsole('GetCookies: Failed to load widget script');
  data.gtmOnFailure();
}, 'getcookies-widget');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://getcookies.co/*"
              },
              {
                "type": 1,
                "string": "https://api.getcookies.co/*"
              },
              {
                "type": 1,
                "string": "https://getcookies.co/static/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "getcookies_consent"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "ads_data_redaction"
              },
              {
                "type": 1,
                "string": "url_passthrough"
              },
              {
                "type": 1,
                "string": "developer_id.dODAxZj"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__GetCookiesGTM"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__GETCOOKIES_DOMAIN_ID"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Sets default consent state when consent mode enabled
  code: |-
    const mockData = {
      domainId: '12345678-1234-1234-1234-123456789012',
      consentModeEnabled: true,
      waitForUpdate: 500,
      urlPassthrough: true,
      adsDataRedaction: 'dynamic',
      defaultAnalytics: 'denied',
      defaultAdStorage: 'denied',
      defaultAdUserData: 'denied',
      defaultAdPersonalization: 'denied',
      defaultFunctionality: 'denied',
      defaultPersonalization: 'denied'
    };

    mock('setDefaultConsentState', function(consent) {
      assertThat(consent.ad_storage).isEqualTo('denied');
      assertThat(consent.analytics_storage).isEqualTo('denied');
      assertThat(consent.wait_for_update).isEqualTo(500);
    });

    mock('gtagSet', function() {});
    mock('localStorage', { getItem: function() { return null; } });
    mock('setInWindow', function() {});
    mock('injectScript', function(url, onSuccess) { onSuccess(); });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();

- name: Restores consent from localStorage
  code: |-
    const mockData = {
      domainId: '12345678-1234-1234-1234-123456789012',
      consentModeEnabled: true,
      waitForUpdate: 500,
      adsDataRedaction: 'dynamic'
    };

    const storedConsent = JSON.stringify({
      categories: ['necessary', 'analytics', 'marketing']
    });

    mock('setDefaultConsentState', function() {});
    mock('updateConsentState', function(consent) {
      assertThat(consent.analytics_storage).isEqualTo('granted');
      assertThat(consent.ad_storage).isEqualTo('granted');
    });
    mock('gtagSet', function() {});
    mock('localStorage', { getItem: function() { return storedConsent; } });
    mock('queryPermission', function() { return true; });
    mock('setInWindow', function() {});
    mock('injectScript', function(url, onSuccess) { onSuccess(); });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

GetCookies CMP - Google Tag Manager Template
Version 1.0.0

Features:
- Full Google Consent Mode v2 support
- Sets default consent state BEFORE any tags fire
- Reads existing consent from localStorage
- Real-time consent updates when user interacts with banner
- Supports all consent types: ad_storage, ad_user_data, ad_personalization, analytics_storage, functionality_storage, personalization_storage
- URL passthrough for conversion measurement when cookies denied
- Ads data redaction option

For documentation, visit: https://getcookies.co/help/gtm-installation
For support, visit: https://getcookies.co/support

Copyright 2024 GetCookies
Licensed under Apache License 2.0
